---
title: "Temperature"
output: rmarkdown::html_vignette
bibliography: '`r system.file("references.bib", package="weatheR")`'
vignette: >
  %\VignetteIndexEntry{Temperature}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
---

```{r setup, include = FALSE}
library(weatheR)
library(tidyverse)
library(ggsci)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  dpi = 600,
  fig.width = 6,
  fig.height = 5,
  fig.align = "center",
  out.width = "100%"
)
```


# Growing degree-days

Growing degree day can be calculate in several ways @mcmaster_growing_1997:

- Equation 1
$$GDD = \frac{(T_{max} + T_{min})}{2} - T_{base}$$
- Method 1: if $(T_{max} + T_{min})/2 < T_{base}$ then the right part is equal 
to $T_{base}$\. According to @mcmaster_growing_1997, this method is 
widespread in modeling.\
- Method 2: if $T_{max} < T_{base}$ then $T_{max} = T_{base}$ and if 
$T_{min} < T_{base}$ then $T_{min} = T_{base}$.This method is used for corn
(@mcmaster_growing_1997).\


- Equation 2 @pessotto_determining_2023

$$0, ~T_{avg} <=  T_{base} ~or~ T_{avg} >= T_{max} \\ \frac{T_{avg} - T_{base}}{T_{opt} - T_{base}}, T_{base} <= T_{avg} <= T_{opt} \\ 1-\frac{T_{avg} - T_{opt}}{T_{max} - T_{opt}}, T_{opt} <= T_{avg} <= T_{max}$$

- 





```{r rate-of-development}
# Cardinal temperatures
T_base <- 5
T_opt <- 15
T_opt_1 <- 10
T_opt_2 <- 20
T_max <- 25

# Calculation
rate_of_development <- 
  tibble(.rows = 31) %>% 
  mutate(
    T_air_avg = seq(0, 30, 1),
    # Method A
    method_a =
      t_daily_thermal_unit(
        T_air_avg = T_air_avg,
        T_base = T_base,
        method = "A"
      )[["rate_of_development"]],
    # Method C
    method_c =
      t_daily_thermal_unit(
        T_air_avg = T_air_avg,
        T_base = T_base,
        T_opt = T_opt,
        T_max = T_max,
        method = "C"
      )[["rate_of_development"]],
    # Method D
    method_d = 
      t_daily_thermal_unit(
        T_air_avg = T_air_avg,
        T_base = T_base,
        T_opt_1 = T_opt_1,
        T_opt_2 = T_opt_2,
        T_max = T_max,
        method = "D"
      )[["rate_of_development"]]
  ) %>% 
  pivot_longer(cols = c(#"method_a",
    #"method_c",
    "method_d"),
    names_to = "variable",
    values_to = "value")

# Plot
ggplot(rate_of_development,
       aes(x = T_air_avg,
           y = value,
           color = variable)) +
  geom_point() +
  theme_bw() +
  xlab("Average air temperature (°C)") +
  ylab("Rate of development (1/d)") +
  labs(color = "Rate of \ndevelopment \nmethod")
```


```{r growing-degree-days}
# Cardinal temperatures
T_base <- 5
T_opt <- 15
T_opt_1 <- 10
T_opt_2 <- 20
T_max <- 25

# Calculation
growing_degree_days <- 
  weather_blue_grass_airport %>% 
  filter(date > "2022-10-01",
         date < "2023-04-20") %>% 
  mutate(
    T_air_avg = (T_air_max + T_air_min)/2,
    # Method A
    method_a =
      cumsum(
        t_daily_thermal_unit(
          T_air_avg = T_air_avg,
          T_base = T_base,
          method = "A"
        )[["growing_degree_days"]]
      ),
    # Method C
    method_c =
      cumsum(
        t_daily_thermal_unit(
          T_air_avg = T_air_avg,
          T_base = T_base,
          T_opt = T_opt,
          T_max = T_max,
          method = "C"
        )[["growing_degree_days"]]
      ),
    # Method D
    method_d = 
      cumsum(
        t_daily_thermal_unit(
          T_air_avg = T_air_avg,
          T_base = T_base,
          T_opt_1 = T_opt_1,
          T_opt_2 = T_opt_2,
          T_max = T_max,
          method = "D"
        )[["growing_degree_days"]]
      )
  ) %>% 
  pivot_longer(cols = c("method_a",
                        "method_c",
                        "method_d"),
               names_to = "variable",
               values_to = "value")

# Plot
ggplot(growing_degree_days,
       aes(x = date,
           y = value,
           color = variable)) +
  geom_point() +
  theme_bw() +
  xlab("Average air temperature (°C)") +
  ylab("Growing degree days (°C/d)") +
  labs(color = "Growing degree/n days")
```


